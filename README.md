# Wikimedia Revision to Convokit Pipeline
####Turning streams of Wikipedia talk page edits into digestible conversations

### Goal of this project
We aim to ultimately allow for the continuous stream of revisions that constitute Wikimedia websites to be processed on-the-fly into the [convokit](https://convokit.cornell.edu/). Convokit offers a powerful platform for NLP work to be done on such data. This package is intended for use in a demo project that processes English-speaking Wikipedia talk page revisions, though is certainly extensible to other languages and other Wikimedia sites given the consistency of the [Wikimedia REST API](https://www.mediawiki.org/wiki/REST_API) across all such sites.

### Data model
#### Block
The unit of a Wikimedia revision is referred to as a Block in this package. 

[This example](https://en.wikipedia.org/w/index.php?diff=534071961&oldid=534071347&title=Talk:Cornell_University) of a Wikipedia revision demonstrates how blocks constitute a revision: this particular revision shows two blocks greyed out that were already on the talk page and remained unchanged, then three blue blocks where content was added. 

We encode a block in a Block object that contains information about the text it contains, who was responsible for the text in the block, to which blocks it replies, and other metadata used internally to form a conversation from a collection of Blocks. 

#### Intermediate
Given that revisions occur atomically, with only a [little bit of context](https://en.wikipedia.org/w/index.php?diff=552007054&oldid=551989417&title=Talk:Cornell_University) about where they appear within a page, it is necessary to create some data structure that accumulates a series of revisions so that, after some number of revisions have been processed, there is a conversation-like structure from which we can form a convokit Corpus object. 

This structure is the Intermediate, so named because it is the intermediate format between a stream of revisions and convokit. It has three data-relevant attributes:

- hash_lookup: a dictionary whose key-value pairs allow the intermediate format to look up the latest revision of some block. It may be the case in revision n that someone relies to a comment with hash "abc", but block "abc" is modified in revision n+1 and has a new hash "def". In this case, the hash table would contain an entry "abc":"def", and "def":"def". A key mapped to itself indicates that this is the final revision of a block.
- blocks: a dictionary whose keys are block hashes (the md5 hash of the text of a block) and values are Block objects
- revisions: a list of revision objects describing the behavior of revision - this can be used more for debugging and is not incorporated in the final corpus

#### Corpus
The convokit corpus generated from the intermediate follows the normal design patterns for convokit corpora. The only caveat about corpora generated by this package is that the corpus is generated on-the-fly from an Intermediate - it does not store the corpus on its own.  



### Overview of files
 - block.py: the Block class
 - helpers.py: as the name suggests, a few helper functions used throughout the package
 - intermediate.py: the Intermediate class
 - pipeline.py: the main file containing all pipeline methods

<!-- ### Implementation
The procedure for conversion is broken down into three parts: fetching, processing, and conversion. All three of these steps happen every time the core function of this package (get_corpus) is invoked.

#### 1. Fetching
We use the Wikimedia REST API

#### 2. Conversion
 -->
